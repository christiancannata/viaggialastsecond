var translations = {
    "it": {
        "company_page_button": "Scopri",
        "share_job": "condividi annuncio",
        "apply_now_button": "Candidati",
        "job_purpose": "Descrizione",
        "esplora_azienda": "Esplora azienda",
        'esperienza_lavorativa_creata': "L'esperienza è stata aggiunta al tuo profilo",
        'esperienza_lavorativa_aggiornata': "L'esperienza è stata modificata",
        'education_creata': "L'esperienza è stata aggiunta al tuo profilo",
        'lingua_pubblicata': "La lingua è stata aggiunta al tuo profilo",
        'presente': 'Presente',
        'cancella': "Annulla",
        'delete': "Rimuovi",
        'continua': "Continua",
        "cv_uploaded": "Il tuo curriculum è stato caricato",
        "remove_element": "Sei sicuro di rimuovere questo elemento?",
        "remove_title": "Conferma rimozione",
        "check_email": "Controlla la tua casella di posta elettronica per modificare la tua password.",
        "net_error": "Si è verificato un errore di rete: verifica la tua connessione internet per continuare",
        "net_error_title": "Errore di rete",
        "notif_title": "Attiva le notifiche per essere aggiornato sulle tue candidature",
        "notif_title_2": 'Feedback sulla tua candidatura',
        "notif_desktop": "Questo è un'esempio di notifica",
        "notif_mobile": "Questo è un'esempio di notifica",
        "notif_unsub": "(Riceverai anche opportunità lavorative inerenti al tuo profilo)",
        "un_notif": "Le notifiche push sono state disabilitate",
        "notif_ok": "Le notifiche push sono state abilitate",
        "ok_opt": "Operazione completata",
        "disable_title": "Disabilita account",
        "disable_desc": "Sei sicuro di voler disabilitare il tuo account di Meritocracy? Perderai le candidature inviate e le aziende non potranno contattarti per altre opportunità lavorative.",
        "disable_btn": "Disabilita",
        "account_disabled_title": "Account disabilitato",
        "account_disabled_desc": "Siamo dispiaciuti che hai deciso di disabilitare il tuo account. Contatta info@meritocracy.is se desideri recuperarlo",
        "complete_profile_title": "Completa il tuo profilo",
        "complete_profile_desc": "Congratulazioni! La tua candidatura è stata inviata correttamente. I recruiter spendono fino a 5 volte più tempo su un profilo completo: aggiungi ulteriori esperienze lavorative e formative",
        "complete_profile_btn": "Completa profilo",
        "fill_fields_application_title": "Completa i campi",
        "password_email_recovery": "Verifica che l'indirizzo email sia valido",
        "fill_fields_application_desc": "Completa il nome, cognome e indirizzo email per candidarti",
        "registration_company_title_success": "La tua registrazione è stata completata, ora puoi creare la tua Branding Page per valorizzare il tuo Employer Brand\nArricchisci la tua pagina con maggiori informazioni e con immagini dei tuoi spazi lavorativi.",
        "registration_company_btn_success": "Arricchisci Branding Page",
        "registration_company_btn_cancel": "Anteprima Branding Page",
        "unable_to_apply": "Impossibile candidarsi con",
        "unable_to_apply_soc": "Non è stato possibile candidarti con %c perchè non hai autorizzato l'applicazione oppure si è verificato un'errore.",
        "cv_needed_title": "Curriculum non caricato",
        "cv_needed_desc": "Per candidarti è necessario caricare il tuo curriculum",
        "already_registered_title": "Account già esistente",
        "already_registered_desc": "Sembra che l'indirizzo %e sia già associato ad un account esistente.\nAccedi con il tuo account o usa un altro indirizzo email per candidarti.",
        "already_registered_btn_1": "Accedi al tuo account",
        "already_registered_btn_2": "Usa altra email",
        "upload_cv_btn": "Carica curriculum",
        "filepicker_error_load": "Impossibile caricare il plugin di FileStack.\nPer candidarti, ti invitiamo a registrarti manualmente oppure contatta il supporto",
        "generic_cv_analyze_error": "Non siamo riusciti ad analizzare il tuo curriculum.\nPer candidarti registrati manualmente oppure contatta il supporto",
        "register_manual": "Registrati",
        "contact_support": "Contatta supporto",
        "error_occurred": "Si è verificato un'errore",
        "error_registration": "Impossibile registrarsi",
        "rename_file_title": "Rinomina file",
        "rename_file_desc": "Immetti nome per rinominare il file",
        "rename_file_success": "Il file è stato rinominato con successo",
        "expired_session_apply": "Non è stato possibile procedere con la candidatura perchè la sessione è scaduta. Aggiorna la pagina e candidati nuovamente a questa posizione",
        "expired_session_title": "Sessione scaduta",
        "removed_element": "L'elemento è stato rimosso correttamente dal tuo profilo",
        "removed_element_title": "L'elemento è stato rimosso",
        "accetta_condizioni": "Accetta le condizioni di Privacy Policy"


    },
    "en": {
        "error_occurred": "An error has occurred",
        "company_page_button": "company page",
        "apply_now_button": "apply now",
        "share_job": "share job",
        "job_purpose": "Job Purpose",
        "esplora_azienda": "Explore company",
        'esperienza_lavorativa_creata': 'Work experience added to your profile',
        'esperienza_lavorativa_aggiornata': 'Work experience updated',
        'education_creata': 'Education added to your profile',
        'lingua_pubblicata': 'Language added to your profile',
        'presente': 'Today',
        'delete': "Delete",
        'cancella': "Cancel",
        'continua': "Continue",
        "cv_uploaded": "The resume is now uploaded successfully",
        "remove_element": "Are you sure you want to remove this element?",
        "check_email": "Check your email to reset your password.",
        "remove_title": "Remove element",
        "net_error": "Unable to continue due to a network error: Please check your internet connectivity",
        "net_error_title": "Network error",
        "notif_title": "Enable notifications about your application",
        "notif_title_2": 'You have received a feedback about your application',
        "notif_desktop": "This is an example of a notification",
        "notif_mobile": "This is an example of a notification",
        "notif_unsub": "(You will receive notifications of other job opportunities)",
        "un_notif": "Push notification has been disabled",
        "notif_ok": "Push notification has been enabled",
        "ok_opt": "Operation completed",
        "disable_title": "Disable account",
        "disable_btn": "Disable",
        "disable_desc": "Are you sure you want to disable your account? You'll lose the submitted applcation and our companies can not contact you for other job opportunities.",
        "account_disabled_title": "Account disabled",
        "account_disabled_desc": "We are sorry that you have decided to disable your account. Please contact info@meritocracy.is to restore your account.",
        "complete_profile_title": "Complete your profile",
        "complete_profile_desc": "Congratulations! Your Application has been submitted, now is the time to stand out!\nA complete profile makes recruiters 5 times more willing to spend time on your application",
        "complete_profile_btn": "Complete profile",
        "fill_fields_application_title": "Fill all fields",
        "fill_fields_application_desc": "Complete the first name, last name and your email to apply for this job position",
        "registration_company_title_success": "Your registration is now completed",
        "registration_company_details_success": "Start adding information to your company page, to empower your Employer Brand.",
        "registration_company_btn_success": "Enhance Branding Page",
        "registration_company_btn_cancel": "Preview Branding Page",
        "unable_to_apply": "Unable to Apply with ",
        "unable_to_apply_soc": "Sorry, we are unable to apply with %c because you are not authorized the application or an error occurred.\nPlease apply with another option",
        "cv_needed_title": "Curriculum not uploaded",
        "cv_needed_desc": "Please upload your curriculum to apply for this position",
        "already_registered_title": "Meritocracy Account already exists",
        "already_registered_desc": "Your email address %e seems to be already associated with a Meritocracy Account. Log In to your account or use a different email to apply",
        "already_registered_btn_1": "Log In to your account",
        "already_registered_btn_2": "Use a different email",
        "upload_cv_btn": "Upload cv",
        "register_manual": "Register manually",
        "contact_support": "Contact support",
        "filepicker_error_load": "Unable to load FileStack plugin.\nTo apply, please Sign Up manually or contact our support",
        "generic_cv_analyze_error": "We are unable to analyse your CV.\nTo apply, please Sign Up manually or contact our support",
        "error_registration": "Unable to Sign Up",
        "rename_file_title": "File renamed",
        "rename_file_desc": "Type the name to rename the file",
        "rename_file_success": "The file was renamed succesfully",
        "expired_session_apply": "It was not possible to proceed with the application because the session has expired. Please refresh the page again and candidates to this position",
        "expired_session_title": "Session expired",
        "removed_element": "The element was removed from your profile",
        "removed_element_title": "Element removed",
        "accetta_condizioni": "Please indicate that you have read and agree the Privacy Policy",
        "password_email_recovery": "Verify that your email address is valid"


    }
};

$.fn.stripClass = function (partialMatch, endOrBegin) {
    var x = new RegExp((!endOrBegin ? "\\b" : "\\S+") + partialMatch + "\\S*", 'g');

    // http://stackoverflow.com/a/2644364/1037948
    this.attr('class', function (i, c) {
        if (!c) return;
        return c.replace(x, '');
    });
    return this;
};


function hostReachable() {
    return true;
}
function changeLocale(locale) {

    var newLocale = $(locale).attr("data-locale");
    var originalLocale = $(locale).attr("data-original-locale");

    var string = window.location.href.replace("/" + originalLocale, "/" + newLocale);
    window.location.replace(string);

}

function appendToSelect(array, selectIdentifier) {
    var select = $("select" + selectIdentifier);


    $.each(select, function () {
        var sl = this;
        $.each(array, function () {
            if (this.text != null && this.text != "null") {
                $(sl).append($("<option>").val(this.value).text(this.text));
            }
        });
        $(sl).material_select('update');
        $(sl).closest('.input-field').children('span.caret').remove();
    });

}

function appendToSelect_API(url, select) {
    var cacheIdentifier = "_select-api-" + url;

    localStorage.clear();

    var array = sessionStorage.getItem(cacheIdentifier);
    if (1) {
        $.get(url, function (data) {
            var array = [];
            $.each(data, function (index, data) {

                if (url == "/search/systemLanguage") {
                    if ($("html").attr("lang") == "it" && data.italian_name != "" && data.italian_name != null) {
                        array.push({value: data.id, text: data.italian_name});
                    } else {
                        array.push({value: data.id, text: data.name});
                    }

                } else if (url != "/search/degree") {
                    if ($("html").attr("lang") == "it" && data.name_it != "") {
                        array.push({value: data.id, text: data.name_it});
                    } else {
                        array.push({value: data.id, text: data.name});
                    }

                } else {
                    array.push({value: data.name, text: data.name});
                }


            });
            sessionStorage.setItem(cacheIdentifier, JSON.stringify(array));
            appendToSelect(array, select);

        });
    } else {
        array = JSON.parse(array);
        appendToSelect(array, select);
    }
}


function validateURL(textval) {
    var urlregex = /^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;
    return urlregex.test(textval);
}

function logout() {
    $.removeCookie('logged');
    window.location.href = "/logout";
    sessionStorage.setItem("logged-out", 1);
}

function hideAlerts(div) {

    window.div = div;
    $(div).prevAll(".alert").first().hide();
}
function CVButtonApply(div) {
    ga('send', 'event', 'button', 'click', 'Apply CV button');

    window.div = div;
    $(div).prevAll(".alert").first().hide();
    try {
        filepicker.setKey("A8gsh1avRW6BM45L8W9tqz");

        filepicker.pick(
            {
                maxFiles: 1,
                container: 'modal',
                services: ['COMPUTER', 'GMAIL', 'DROPBOX', 'GOOGLE_DRIVE', 'SKYDRIVE', 'BOX', 'CLOUDDRIVE'],
                extensions: ['.pdf', '.doc', '.docx', '.odt', '.xls', '.xlsx'],
                language: $("html").attr("lang")
            },
            function (Blob) {

                view.cvUrl = Blob.url;
                view.loading = true;
                $(".application-content").hide();
                $(".application-parsing-animation").show();

                var parsingCvJson = {"type": "PARSING_CV_FILEPICKER", "file": view.cvUrl};

                $.ajax({
                    type: "POST",
                    url: "https://app.meritocracy.is/includes/file_upl.php",
                    data: parsingCvJson,
                    success: function (data, textStatus, xhr) {

                        view.loading = true;
                        $(".application-error").text("").hide();

                        if (data.success == 1) {
                            Vacancy.elaborateCv(data, function (success, profile, parsedCv) {
                                if (success == 1) {

                                    try {
                                        $(".title-modal-mail").text($(".title-modal-mail").text().replace("%c", profile.name.capitalizeFirstLetter()));
                                        $('.application-email').val(profile.mail);
                                        $('.application-name').val(profile.name);
                                        $('.application-surname').val(profile.surname);
                                    } catch (ee) {
                                    }
                                    $("#apply_phase_1," +
                                        ".application-div-other," +
                                        ".application-parsing-animation").hide();
                                    $(".application-content,.application-div-button").show();
                                    $("#apply_phase_3").fadeIn();

                                    $(".datepicker").datepicker({
                                        dateFormat: 'dd-mm-yy',
                                        changeYear: true,
                                        yearRange: '1940:2015',
                                        changeMonth: true
                                    });

                                    view.isValid = true;
                                    view.profile = profile;

                                    view.parsedCv = parsedCv;

                                }
                            });


                        } else {
                            $(".application-content").show();
                            $(".application-parsing-animation").hide();
                            swal({
                                    title: trans('error_occurred'),
                                    text: trans('generic_cv_analyze_error'),
                                    type: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: "#DD6B55",
                                    confirmButtonText: trans('register_manual'),
                                    cancelButtonText: trans('contact_support'),
                                    closeOnConfirm: true
                                },
                                function (isConfirm) {
                                    if (isConfirm) {
                                        manualApply(null, true);

                                    } else {
                                        window.location.href = "mailto:info@meritocracy.is?subject=[Error] Unable to apply for vacancy: " + $("#vacancyId").val() + "&body=Please upload your CV and we will apply for you";
                                    }
                                });

                        }
                    },
                    error: function (data, textStatus, xhr) {
                        $(".application-content").show();
                        $(".application-parsing-animation").hide();
                        swal({
                                title: trans('error_occurred'),
                                text: trans('generic_cv_analyze_error'),
                                type: "warning",
                                showCancelButton: true,
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: trans('register_manual'),
                                cancelButtonText: trans('contact_support'),
                                closeOnConfirm: true
                            },
                            function (isConfirm) {
                                if (isConfirm) {
                                    manualApply(null, true);
                                } else {
                                    window.location.href = "mailto:info@meritocracy.is?subject=[Error] Unable to apply for vacancy: " + $("#vacancyId").val() + "&body=Please upload your CV and we will apply for you";
                                }
                            });
                    },
                    dataType: "json"
                });


            },
            function (FPError) {

            }
        );
    } catch (e) {

        swal({
                title: trans('error_occurred'),
                text: trans('filepicker_error_load'),
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: trans('register_manual'),
                cancelButtonText: trans('contact_support'),
                closeOnConfirm: true
            },
            function (isConfirm) {
                if (isConfirm) {
                    manualApply(null, true);
                } else {
                    window.location.href = "mailto:info@meritocracy.is?subject=[Error] Unable to apply for vacancy: " + $("#vacancyId").val() + "&body=Please upload your CV and we will apply for you";
                }
            });


        Raven.captureException(e);

    }

}

function trans(word) {

    return translations[$("html").attr("lang")][word];

}
window.alert = function (message, title, type, callbackConfirm) {
    try {
        if (title != null && type != null && callbackConfirm != null) {
            swal({
                title: title,
                text: message,
                type: type,
                confirmButtonColor: "#F04D52",
                confirmButtonText: "OK",
                closeOnConfirm: true,
                showCancelButton: true
            }, function () {
                callbackConfirm();
            });
        }
        if (title != null && type != null) {
            swal({
                title: title,
                text: message,
                type: type,
                confirmButtonColor: "#F04D52",
                confirmButtonText: "OK",
                closeOnConfirm: true
            });
        } else {
            swal(message);
        }
    } catch (ee) {
        alert(message);
    }

};
function getCookie(name) {
    var value = "; " + document.cookie;
    var parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift();
}
function isLogged() {
    return $("#input-logged").length > 0;
}

function isMobile() {
    var check = false;
    (function (a) {
        if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4)))check = true
    })(navigator.userAgent || navigator.vendor || window.opera);
    return check;
}
function findBootstrapEnvironment() {
    var envs = ['xs', 'sm', 'md', 'lg'];

    var $el = $('<div>');
    $el.appendTo($('body'));

    for (var i = envs.length - 1; i >= 0; i--) {
        var env = envs[i];

        $el.addClass('hidden-' + env);
        if ($el.is(':hidden')) {
            $el.remove();
            return env;
        }
    }
}

function setCarouselHeight(id) {
    var slideHeight = [];
    $(id + ' .item').each(function () {
        // add all slide heights to an array
        slideHeight.push($(this).height());
    });

    // find the tallest item
    max = Math.max.apply(null, slideHeight);

    // set the slide's height
    $(id + ' .carousel-content').each(function () {
        $(this).css('height', max + 'px');
    });
}

function sendAjaxCall(json, url, callback) {


    $.ajax({ // make an AJAX request
        type: "POST",
        url: url,
        dataType: 'json',
        data: json,

        success: function (data, textStatus, xhr) {
            callback(data, textStatus, xhr);
        },
        error: function (request, status, error) {
            callback(error, -10, request);
        }

    });
}
function getURLParameter(name) {
    return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [, ""])[1].replace(/\+/g, '%20')) || null
}


function updateId() {
    if (OneSignal != null) {
        OneSignal.push(["getUserId", function (userId) {
            if (userId != null) {
                $.cookie('pushId', userId);

                if (isLogged() && ($.cookie('pushIdSet') == null || $.cookie('pushIdSet') != 1)) {
                    $.post("/user/setPushId", {pushId: userId}, function (data, status, xhr) {
                        if (xhr.status == 204) {
                            $.cookie('pushIdSet', 1);
                        }

                    });
                }

            }

        }]);
    }
}
function requirePush() {
    if (OneSignal != null) {
        OneSignal.push(["isPushNotificationsEnabled", function (enabled) {
            if (!enabled) {
                OneSignal.push(["registerForPushNotifications", {modalPrompt: true}]);
            }
        }]);
    }
}

jQuery(document).ready(function ($) {


    try {

        $(".fade-trigger").each(function () {
            $(this).on("click", function () {
                var t = $(this).attr("data-target");

                if (!$(t).hasClass("triggered")) {
                    $(t).fadeOut();
                    $(".sp-placeholder").show();
                    $(".sp-change:visible").removeClass("fa fa-minus").addClass("fa fa-plus");

                    $(t).addClass("triggered");
                } else {
                    $(t).fadeIn();
                    $(".sp-placeholder").hide();
                    $(".sp-change:visible").removeClass("fa fa-plus").addClass("fa fa-minus");
                    $(t).removeClass("triggered");

                }

            })

        });
        if (OneSignal != null) {


            updateId();
            OneSignal.push(function () {
                // Occurs when the user's subscription changes to a new value.
                OneSignal.on('subscriptionChange', function (isSubscribed) {
                    updateId();
                    alert("", trans('ok_opt'), "success");

                });
            });
        }


        if (getURLParameter("loggedAuto") == 1) {
            $('.auto-login-popover').popover('show');
            setTimeout(function () {
                $('.auto-login-popover').popover('hide');
            }, 9000);
        }


    } catch (e) {
        Raven.captureException(e);
    }

    $(document).on('click', '.modify-education,.modify-experience', function (e) {
        e.preventDefault();
        $("button").removeAttr("disabled");

        var button = $(this);


        button.closest(".summary-box").addClass("hide");
        button.closest(".summary-box").parent().find(".form").removeClass("hide");
        var textarea = button.closest(".summary-box").parent().find(".form textarea");

        textarea.addClass("materialize-textarea");

    });

    $(document).on("click", ".homepage #companies .col:nth-child(1) .box a", function (e) {
        e.preventDefault();
        ga('send', {
            hitType: 'event',
            eventCategory: 'Company Homepage Box 1',
            eventAction: 'click',
            eventLabel: $(this).closest(".box").find(".hidden-sm.hidden-xs h3").text()
        });

        location.href = $(this).attr("href");


    });

    $(document).on("click", ".homepage #companies .col:nth-child(2) .box a", function (e) {
        e.preventDefault();
        ga('send', {
            hitType: 'event',
            eventCategory: 'Company Homepage Box 2',
            eventAction: 'click',
            eventLabel: $(this).closest(".box").find(".hidden-sm.hidden-xs h3").text()
        });
        location.href = $(this).attr("href");

    });


    $(document).on("click", ".scopri-tutte", function (e) {
        ga('send', {
            hitType: 'event',
            eventCategory: 'Scopri Tutte Aziende Homepage',
            eventAction: 'click',
            eventLabel: "Scopri Tutte Aziende Homepage"
        });

    });


    $(document).on("click", ".homepage #companies .col:nth-child(3) .box a", function (e) {
        e.preventDefault();

        ga('send', {
            hitType: 'event',
            eventCategory: 'Company Homepage Box 3',
            eventAction: 'click',
            eventLabel: $(this).closest(".box").find(".hidden-sm.hidden-xs h3").text()
        });

        location.href = $(this).attr("href");


    });

    $(document).on("click", ".homepage #companies .col:nth-child(4) .box a", function (e) {
        e.preventDefault();

        ga('send', {
            hitType: 'event',
            eventCategory: 'Company Homepage Box 4',
            eventAction: 'click',
            eventLabel: $(this).closest(".box").find(".hidden-sm.hidden-xs h3").text()
        });

        location.href = $(this).attr("href");

    });


    $(document).on("click", ".close-edit-work-experience", function (e) {
        e.preventDefault();

        $(this).closest(".form").addClass("hide");
        $(this).closest('.row[data-update-route="work-experience"]').find(".work-experience").removeClass("hide");

    });


    $(document).on("click", ".close-edit-education", function (e) {
        e.preventDefault();

        $(this).closest(".form").addClass("hide");
        $(this).closest('.row[data-update-route="education"]').find(".work-experience").removeClass("hide");

    });
    $(document).on("submit", ".edit-education", function (e) {
        e.preventDefault();

        $(".edit-education").find("button").prop("disabled", true);

        var params = $(".edit-education").find("select,textarea,input").serialize();
        var form = $(this);
        $.ajax({
            type: "PATCH",
            url: "/education",
            dataType: "json",
            data: params,
            success: function (data, textStatus, xhr) {
                console.log(data);

                if (xhr.status == 201 || xhr.status == 204) {


                    var id = data.id;


                    $.ajax({
                        type: "GET",
                        url: "/education/" + id,
                        success: function (data, textStatus, xhr) {
                            if (xhr.status == 200 || xhr.status == 201) {

                                if ($("#education-collections .empty-row").length) {
                                    $("#education-collections .empty-row").remove();
                                }

                                $(data).insertAfter("#education-collections h4.header");
                                Materialize.toast('<span>' + trans('education_creata') + '</span>', 4000);
                                form.closest(".row").hide();
                                $("button").removeAttr("disabled");
                                $("select").material_select('update');

                                $(".datepicker").MonthPicker({
                                    MaxMonth: 0,
                                    i18n: {
                                        year: "Year",
                                        prevYear: "Previous Year",
                                        nextYear: "Next Year",
                                        next5Years: 'Jump Forward 5 Years',
                                        prev5Years: 'Jump Back 5 Years',
                                        nextLabel: "Next",
                                        prevLabel: "Prev",
                                        buttonText: "Open Month Chooser",
                                        jumpYears: "Jump Years",
                                        months: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
                                    },
                                    OnAfterChooseMonth: function (selectedDate) {

                                        $(this).parent().find("label").addClass("active");
                                        $(this).parent().find(".prefix").addClass("active");
                                        $(this).addClass("valid");
                                    },
                                    OnAfterMenuOpen: function (event) {
                                    },
                                    // Creates the default button.
                                    ShowIcon: false

                                });


                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            Materialize.toast("[Profile] Unable to add education", 4000);
                            Raven.setExtraContext({
                                "Ajax xhr": jqXHR,
                                "Ajax ajaxOptions": ajaxOptions,
                                "Ajax thrownError": thrownError
                            });
                            Raven.showReportDialog();

                        }
                    });


                }
            },
            error: function (data, textStatus, xhr) {
                $(".edit-work-experience").find("button[type=submit]").after(data.responseJSON.message);
            }
        });


    });

    $(document).on("submit", ".edit-work-experience", function (e) {
        e.preventDefault();

        $(this).find("button").prop("disabled", true);

        var params = $(this).find("select,textarea,input").serialize();
        var form = $(this);
        $.ajax({
            type: "PATCH",
            url: "/work-experience",
            dataType: "json",
            data: params,
            success: function (data, textStatus, xhr) {

                if (xhr.status == 201 || xhr.status == 204) {


                    var id = data.id;

                    $.ajax({
                        type: "GET",
                        url: "/work-experience/" + id,
                        success: function (data, textStatus, xhr) {
                            if (xhr.status == 200 || xhr.status == 201) {

                                if ($("#work-collections .empty-row").length) {
                                    $("#work-collections .empty-row").remove();
                                }
                                console.log('#work-collections .row[data-id="' + id + '"]');
                                $('#work-collections .row[data-id="' + id + '"]').replaceWith(data);
                                $("#work-collections .form ").addClass("hide");
                                $("#work-collections .summary-box").removeClass("hide");
                                Materialize.toast('<span>' + trans('esperienza_lavorativa_aggiornata') + '</span>', 4000);
                                $("button").removeAttr("disabled");
                                $("select").material_select('update');

                                $(".datepicker").MonthPicker({
                                    MaxMonth: 0,
                                    i18n: {
                                        year: "Year",
                                        prevYear: "Previous Year",
                                        nextYear: "Next Year",
                                        next5Years: 'Jump Forward 5 Years',
                                        prev5Years: 'Jump Back 5 Years',
                                        nextLabel: "Next",
                                        prevLabel: "Prev",
                                        buttonText: "Open Month Chooser",
                                        jumpYears: "Jump Years",
                                        months: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
                                    },
                                    OnAfterChooseMonth: function (selectedDate) {

                                        $(this).parent().find("label").addClass("active");
                                        $(this).parent().find(".prefix").addClass("active");
                                        $(this).addClass("valid");
                                    },
                                    OnAfterMenuOpen: function (event) {
                                    },
                                    // Creates the default button.
                                    ShowIcon: false

                                });


                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            Materialize.toast("[Profile] Unable to add a Work Experience", 4000);
                            Raven.setExtraContext({
                                "Ajax xhr": jqXHR,
                                "Ajax ajaxOptions": ajaxOptions,
                                "Ajax thrownError": thrownError
                            });
                            Raven.showReportDialog();

                        }
                    });


                }
            },
            error: function (data, textStatus, xhr) {
                $(".edit-work-experience").find("button[type=submit]").after(data.responseJSON.message);
            }
        });


    });

    $(document).on('click', '.action-button', function (e) {
        e.preventDefault();

        var button = $(this);

        swal({
                title: trans('remove_title'),
                text: trans('remove_element'),
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#F04D52",
                confirmButtonText: trans('delete'),
                closeOnConfirm: false,
                showLoaderOnConfirm: true

            },
            function () {

                $.ajax({
                    url: button.attr("data-href"),
                    dataType: 'json',
                    type: button.attr("data-method"),
                    success: function (data, jqXHR) {

                        alert(trans("removed_element"), trans("removed_element_title"), "info");
                        if (button.closest("tr").length) {
                            button.closest("tr").fadeOut();
                        }
                        if (button.closest("li").length) {
                            button.closest("li").fadeOut();
                        }

                        if (button.closest(".row[data-update-route]").length) {
                            button.closest(".row[data-update-route]").fadeOut();
                        }


                        if (button.closest(".sortable")) {
                            button.closest(".sortable").remove();
                        }

                        if (button.attr("data-redirect")) {
                            location.href = button.attr("data-redirect");
                        }


                    },
                    error: function (data, jqXHR) {
                        swal("Unable to remove the element");
                    }
                });


            });

    });


    if (typeof view !== "undefined") {
        view.modalVerticalCenterClass = ".modal";

        function centerModals($element) {
            var $modals;
            if ($element.length) {
                $modals = $element;
            } else {
                $modals = $(view.modalVerticalCenterClass + ':visible');
            }
            $modals.each(function (i) {
                var $clone = $(this).clone().css('display', 'block').appendTo('body');
                var top = Math.round(($clone.height() - $clone.find('.modal-content').height()) / 2);
                top = top > 0 ? top : 0;
                $clone.remove();
                $(this).find('.modal-content').css("margin-top", top - 50);
            });
        }

        $(view.modalVerticalCenterClass).on('show.bs.modal', function (e) {
            centerModals($(this));
        });
        $(window).on('resize', centerModals);

        if ($("#jolly-carousel").length > 0) {
            setCarouselHeight('#jolly-carousel');
        }
        //if you change this breakpoint in the style.css file (or _layout.scss if you use SASS), don't forget to update this value as well
        var MQL = 1170;

        //primary navigation slide-in effect


        if ($(window).width() > MQL) {
            var headerHeight = $('.cd-header').height();
            $(window).on('scroll',
                {
                    previousTop: 0
                },
                function () {
                    var currentTop = $(window).scrollTop();
                    //check if user is scrolling up
                    if (currentTop < this.previousTop) {
                        //if scrolling up...
                        if (currentTop > 0 && $('.cd-header').hasClass('is-fixed')) {
                            $('.cd-header').addClass('is-visible');
                        } else {
                            $('.cd-header').removeClass('is-visible is-fixed');
                        }
                    } else {
                        //if scrolling down...
                        $('.cd-header').removeClass('is-visible');
                        if (currentTop > headerHeight && !$('.cd-header').hasClass('is-fixed')) $('.cd-header').addClass('is-fixed');
                    }
                    this.previousTop = currentTop;
                });
        }
    }


    //open/close primary navigation
    $('.cd-primary-nav-trigger').on('click', function () {
        $('.cd-menu-icon').toggleClass('is-clicked');
        $('.cd-header').toggleClass('menu-is-open');

        //in firefox transitions break when parent overflow is changed, so we need to wait for the end of the trasition to give the body an overflow hidden
        if ($('.cd-primary-nav').hasClass('is-visible')) {
            $('.cd-primary-nav').removeClass('is-visible').one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function () {
                $('body').removeClass('overflow-hidden');
            });
        } else {
            $('.cd-primary-nav').addClass('is-visible').one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function () {
                $('body').addClass('overflow-hidden');
            });
        }
    });


    $('.carousel-control.left').click(function () {
        $(this).closest(".carousel").carousel('prev');
    });

    $('.carousel-control.right').click(function () {
        $(this).closest(".carousel").carousel('next');
    });

    $('#register-modal').on('hidden.bs.modal', function () {
        $("#registration-form-modal")[0].reset();

    });

    $(".login-back-button").click(function () {
        $("#register-container").hide();
        $("#login-container").fadeIn();
    });
    $(".login-button").click(function (e) {
        e.preventDefault();

        if (isMobile()) {
            window.location.href = "/login";
            return;
        }


        if ($("#bgvid:visible").length > 0) {
            document.getElementById("bgvid").pause();
        }
        $('body').addClass('modal-color-' + $("#register-modal").data('color'));

        $(".modal").modal("hide");
        if ($(this).attr("data-type") == "REGISTER") {
            $("#registration-form-modal")[0].reset();

            $("#register-modal").modal();
            return;
        }


        if (navigator != null && navigator.credentials != null) {
            try {
                navigator.credentials.get({
                    password: true
                }).then(function (cred) {
                    if (cred) {

                        if (cred.type == 'password') {
                            ga('send', 'event', 'category', 'action', 'Credential Manager Log In');

                            $("#login-progress-modal").modal();
                            var opts = {
                                lines: 13 /* The number of lines to draw*/,
                                length: 28 /* The length of each line*/,
                                width: 14 /* The line thickness*/,
                                radius: 42 /* The radius of the inner circle*/,
                                scale: 0.5 /* Scales overall size of the spinner*/,
                                corners: 1 /* Corner roundness (0..1)*/,
                                color: '#FFF' /* #rgb or #rrggbb or array of colors*/,
                                opacity: 0.25 /* Opacity of the lines*/,
                                rotate: 0 /* The rotation offset*/,
                                direction: 1 /* 1: clockwise, -1: counterclockwise*/,
                                speed: 1 /* Rounds per second*/,
                                trail: 60 /* Afterglow percentage*/,
                                fps: 20 /* Frames per second when using setTimeout() as a fallback for CSS*/,
                                zIndex: 2e9 /* The z-index (defaults to 2000000000)*/,
                                className: 'spinner' /* The CSS class to assign to the spinner*/,
                                top: '50%' /* Top position relative to parent*/,
                                left: '50%' /* Left position relative to parent*/,
                                shadow: false /* Whether to render a shadow*/,
                                hwaccel: false /* Whether to use hardware acceleration*/,
                                position: 'relative' /* Element positioning*/
                            };
                            var target = document.getElementById('spin-login-credentials');
                            var spinner = new Spinner(opts).spin(target);

                            // Construct FormData object
                            var form = new FormData();

                            // Append CSRF Token
                            var csrf_token = $("input[name=csrf_token]").val();
                            form.append('csrf_token', csrf_token);

                            // You can append additional credential data to `.additionalData`
                            cred.additionalData = form;


                            fetch("/login", {
                                method: 'POST',
                                credentials: cred
                            }).then(function (r) {
                                if (r.status == 200) {
                                    if ($("#redirectLogin").length && $("#redirectLogin").val() != "") {
                                        window.location.href = $("#redirectLogin").val();
                                    } else {
                                        window.location.href = "/user/dashboard";
                                    }
                                } else {
                                    alert("Invalid email or password: please Log In manually", "Unable to Log ", "error");
                                    $(".modal").modal("hide");
                                    $("#login-modal").modal();
                                }
                            });
                        }
                    } else {
                        $("#login-modal").modal();
                    }

                });

            } catch (e) {
                console.log(e);
            }
        } else {
            $("#login-modal").modal();

        }

    });

    $(".register-button").click(function (e) {
        e.preventDefault();

        if (isMobile()) {
            window.location.href = "/register/user";
            return;
        }
        if ($("#bgvid:visible").length > 0) {
            document.getElementById("bgvid").pause();
        }


        if ($("#register-modal").data('color') != null) {
            $('body').addClass('modal-color-' + $("#register-modal").data('color'));
        }
        if ($("#register-modal").hasClass("modal")) {
            $(".modal").modal("hide");
            $("#register-modal").modal();
        } else {
            $("#login-container").hide();
            $("#register-container").fadeIn();
        }


    });

    $(".password-recovery-link").click(function (e) {
        e.preventDefault();

        if ($("#recover-password-modal").data('color') != null) {
            $('body').addClass('modal-color-' + $("#recover-password-modal").data('color'));
        }
        if ($("#recover-password-modal").hasClass("modal")) {
            $(".modal").modal("hide");
            $("#recover-password-modal").modal();
        } else {
            $("#login-container").hide();
            $("#recover-password-container").fadeIn();
        }


        if ($("#bgvid:visible").length > 0) {
            document.getElementById("bgvid").pause();
        }
    });


    $(document).on("click", ".contact-us-company,.contact-us-company-contact", function (e) {
        e.preventDefault();

        $('body').addClass('modal-color-' + $("#contact-us-company-modal").data('color'));
        $("#contact-us-company-modal").modal();

    });


    $(".login-form").submit(function (e) {

        var opts = {
            lines: 13 /* The number of lines to draw*/,
            length: 28 /* The length of each line*/,
            width: 14 /* The line thickness*/,
            radius: 42 /* The radius of the inner circle*/,
            scale: 0.5 /* Scales overall size of the spinner*/,
            corners: 1 /* Corner roundness (0..1)*/,
            color: '#FFF' /* #rgb or #rrggbb or array of colors*/,
            opacity: 0.25 /* Opacity of the lines*/,
            rotate: 0 /* The rotation offset*/,
            direction: 1 /* 1: clockwise, -1: counterclockwise*/,
            speed: 1 /* Rounds per second*/,
            trail: 60 /* Afterglow percentage*/,
            fps: 20 /* Frames per second when using setTimeout() as a fallback for CSS*/,
            zIndex: 2e9 /* The z-index (defaults to 2000000000)*/,
            className: 'spinner' /* The CSS class to assign to the spinner*/,
            top: '50%' /* Top position relative to parent*/,
            left: '50%' /* Left position relative to parent*/,
            shadow: false /* Whether to render a shadow*/,
            hwaccel: false /* Whether to use hardware acceleration*/,
            position: 'relative' /* Element positioning*/
        };
        $("#spin-login-credentials").empty();
        var target = document.getElementById('spin-login-credentials');
        var spinner = new Spinner(opts).spin(target);
        $("#login-modal-content").hide();
        $("#login-modal-content-progress").show();

        var btn = $("#user-login-btn");
        e.preventDefault();
        var form = $(this);
        var params = $(this).serializeArray();

        form.find(".alert").addClass("hide");


        $.ajax({
            url: $(this).attr("action"),
            dataType: 'json',
            type: $(this).attr("method"),
            data: params,
            success: function (data, jqXHR) {
                if ($("#redirectLogin").length && $("#redirectLogin").val() != "") {
                    window.location.href = $("#redirectLogin").val();
                } else {
                    window.location.href = "/user/dashboard";
                }
            },
            error: function (data, jqXHR) {
                $("#login-modal-content").show();
                $("#login-modal-content-progress").hide();
                var error = $.parseJSON(data.responseText);
                $(".error-login").text(error.message).removeClass("hide");
                btn.button('reset');
            }
        });
    });
    $('#application-modal').on('hidden.bs.modal', function () {

        $("#apply_phase_1").show();
        $("#apply_phase_2,#apply_phase_3").hide();

    });


    $(".apply-button").click(function (e) {
        e.preventDefault();
        $("body").scrollTop(0);
        $('body').stripClass("modal-color").addClass('modal-color-' + $("#application-modal").data('color'));

        $("#application-modal").modal();


        if ($("input[name=attachment]").length) {
            $("input[name=attachment]:first-child").click();
        }

    });


    $("#secondary-menu-button").click(function (e) {
        e.preventDefault();
        $(".secondary-menu").fadeToggle("fast");

    });

    $("#request-info-form").submit(function (e) {
        e.preventDefault();
        var form = $(this);
        var params = $(this).serializeArray();


        form.find(".alert").addClass("hide");

        var $btn = $("#request-info-form").find("button[type=submit]").button('loading');

        $("#request-info-form").find("button[type=submit]").text($("#request-info-form").find("button[type=submit]").attr("data-loading-text"));


        $.ajax({
            url: form.attr("action"),
            dataType: 'json',
            type: form.attr("method"),
            data: params,
            success: function (data, jqXHR) {


                $("#request-info-form").addClass("hide");
                $("#success-request-info").removeClass("hide");
                $(".title-company-popup").hide();


                $btn.button('reset');
                try {
                    ga('send', 'event', 'category', 'action', 'send-request-info-company');

                    fbq('track', 'Lead');

                    twttr.conversion.trackPid('nu4lm', {tw_sale_amount: 0, tw_order_quantity: 0});

                    fbq.push(['track', '6028725383449', {
                        'value': '0.00',
                        'currency': 'EUR'
                    }]);
                } catch (ee) {
                }
            },
            error: function (data, jqXHR) {
                var error = jQuery.parseJSON(data.responseText);
                $(".request-login").text(error.message).removeClass("hide").show();
                $btn.button('reset');
            }
        });


    });


    $(document).on("click", ".pagination li a", function () {
        $('html,body').animate({
                scrollTop: $(".panels-job-container").offset().top
            },
            'fast');
    });


    $(".close-modal").click(function () {
        $("#" + $(this).closest(".modal").attr("id")).modal('hide');
        $("#request-info-form").removeClass("hide");
        $("#success-request-info").addClass("hide");

        if ($("#bgvid:visible").length > 0) {
            document.getElementById("bgvid").play();
        }


    });

    if ($('ul.soc').length) {
        $('ul.soc').share();

    }


});


function uploadCvStandard() {
    filepicker.setKey("A8gsh1avRW6BM45L8W9tqz");


    filepicker.pick(
        {
            maxFiles: 1,
            container: 'modal',
            services: ['COMPUTER', 'GMAIL', 'DROPBOX', 'GOOGLE_DRIVE', 'SKYDRIVE', 'BOX', 'CLOUDDRIVE'],
            extensions: ['.pdf', '.doc', '.docx', '.odt', '.xls', '.xlsx'],
            language: $("html").attr("lang")
        },
        function (Blobs) {
            $(".load-cv-registration-std").attr("disabled", "disabled").html("<i class='fa fa-check'></i> CV caricato");
            $("#cvUrl").val(Blobs.url);

        },
        function (FPError) {
        }
    );
}


function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 8,
        center: {lat: -34.397, lng: 150.644}
    });
    var geocoder = new google.maps.Geocoder();

    document.getElementById('submit').addEventListener('click', function () {
        geocodeAddress(geocoder, map);
    });
}

function geocodeAddress(geocoder, resultsMap) {
    var address = document.getElementById('address').value;
    geocoder.geocode({'address': address}, function (results, status) {
        if (status === google.maps.GeocoderStatus.OK) {
            resultsMap.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
                map: resultsMap,
                position: results[0].geometry.location
            });
        } else {
            alert('Geocode was not successful for the following reason: ' + status);
        }
    });
}


$("#landing-request-info-form").submit(function (e) {
    e.preventDefault();
    var form = $(this);
    var params = $(this).serializeArray();


    form.find(".alert").addClass("hide");

    var $btn = $("#request-info-form").find("button[type=submit]").button('loading');

    $(this).find("button[type=submit]").text($(this).find("button[type=submit]").attr("data-loading-text"));

    form.find("button").addClass("disabled").attr("disabled", true);


    $.ajax({
        url: form.attr("action"),
        dataType: 'json',
        type: form.attr("method"),
        data: params,
        success: function (data, jqXHR) {

            form.find("button").removeClass("disabled").attr("disabled", false);


            // ensures the optimizely object is defined globally using
            window['optimizely'] = window['optimizely'] || [];

            // sends a tracking call to Optimizely for the given event name.
            window.optimizely.push(["trackEvent", "requestSent"]);


            $("#request-info-form").addClass("hide");
            $("#success-request-info").removeClass("hide");
            $(".title-company-popup").hide();

            $("#landing-request-info-form").hide();
            $("#success-request-info").show();


            $btn.button('reset');
            try {

                ga('send', 'event', 'Landing Page', 'richiesta_inviata', 'Richiesta inviata');

                twttr.conversion.trackPid('nu1b3', {tw_sale_amount: 0, tw_order_quantity: 0});


                fbq.push(['track', '6028725383449', {
                    'value': '0.00',
                    'currency': 'EUR'
                }]);
            } catch (ee) {
            }
        },
        error: function (data, jqXHR) {
            var error = jQuery.parseJSON(data.responseText);
            $(".request-login").text(error.message).removeClass("hide").show();
            $btn.button('reset');

        }
    });


});


$("#registration-form-modal").submit(function (e) {
    e.preventDefault();

    $(".register-form-button").button("loading");

    var params = $("#registration-form-modal").find("select,textarea,input").serialize();
    $("#registration-form-modal").find("select,textarea,input").attr("disabled", "disabled");

    if (!hostReachable()) {
        $(".register-btn-modal-std").button('reset');
        alert(trans("net_error"), trans("net_error_title"), "error");
        return;
    }
    var email = $("#exampleInputEmail1").val();


    $.ajax({
        type: "POST",
        url: "/register/user",
        dataType: "json",
        data: params,
        success: function (data, textStatus, xhr) {
            $(".register-form-button").button("reset");

            if (xhr.status == 201 || xhr.status == 204) {
                $("#registration-form").hide();
                $("#registration-success").show();


                if (navigator != null && navigator.credentials != null) {
                    try {
                        var form = document.querySelector('\#registration-form-modal');
                        var cred = new PasswordCredential(form);
                        navigator.credentials.store(cred)
                            .then(function () {
                                // continuation
                            });
                    } catch (e) {
                        Raven.captureException(e);
                    }
                }

                try {
                    var id = data.id;
                    fbq('track', 'CompleteRegistration');
                } catch (ee) {
                }

                location.href = '/register/completed';

            } else {
                $(".register-form-button").button("reset");
                $("#registration-form-modal").find("select,textarea,input,button").removeAttr("disabled", "disabled");
                $("#registration-form-modal").find("select,textarea,input,button").removeClass("disabled");
                $("#registration-form-modal")[0].reset();

                if (xhr.status == 409) {
                    swal({
                            title: trans('already_registered_title'),
                            text: trans('already_registered_desc').replace("%e", email),
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: trans('already_registered_btn_1'),
                            cancelButtonText: trans('already_registered_btn_2'),
                            closeOnConfirm: true
                        },
                        function (isConfirm) {
                            if (isConfirm) {
                                $("#register-container").hide();
                                $("#login-container").fadeIn();
                            }
                        });
                    return;
                }

                alert(trans("net_error"), trans("net_error_title"), "error");
            }
        },
        error: function (data, textStatus, xhr) {
            $(".register-form-button").button("reset");

            $("#registration-form-modal").find("select,textarea,input,button").removeAttr("disabled", "disabled");
            $("#registration-form-modal").find("select,textarea,input,button").removeClass("disabled");
            $("#registration-form-modal")[0].reset();

            if (data.status == 409) {
                swal({
                        title: trans('already_registered_title'),
                        text: trans('already_registered_desc').replace("%e", email),
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: trans('already_registered_btn_1'),
                        cancelButtonText: trans('already_registered_btn_2'),
                        closeOnConfirm: true
                    },
                    function (isConfirm) {
                        if (isConfirm) {
                            $(".modal").modal("hide");
                            $('body').addClass('modal-color-' + $("#login-modal").data('color'));
                            if ($(this).attr("data-type") == "REGISTER") {
                                $("#register-modal").modal();
                                return;
                            }
                            $("#login-modal").modal();
                        } else {

                        }
                    });
                return;
            }

            if (data.responseJSON != null && data.responseJSON.message != null) {
                alert(data.responseJSON.message, trans("error_registration"), "warning");
            } else {
                alert(trans("net_error"), trans("net_error_title"), "error");
            }
        }
    });
});


$(".toggle-recover-password-form-modal").click(function (e) {
    e.preventDefault();
    $(this).closest("form").hide();
    $("#recover-password-form-modal").show();


});


$(".indietro-form").click(function (e) {
    e.preventDefault();

    $(this).closest("form").hide();
    $("#login-form").show();
});

$("#recover-password-form-modal").submit(function (e) {
    var form = $(this);
    e.preventDefault();


    if ($("#emailPassword").val().length > 0 && Meritocracy.validEmail($("#emailPassword").val())) {
        $(".recover-password-btn").attr("disabled", true);

        $.ajax({
            type: "POST",
            url: "/password/recovery/" + $("#emailPassword").val(),
            dataType: "json",
            success: function (data, textStatus, xhr) {
                $(".recover-password-btn").attr("disabled", false);
                if (xhr.status == 201 || xhr.status == 204) {

                    $("#recover-password-form-modal button").hide();
                    $("#recover-password-form-modal .message").html("<p style='color:white'>" + trans("check_email") + "</p>");
                    alert(trans("check_email"), trans("ok_opt"), "success");
                }
            },
            error: function (data, textStatus, xhr) {
                $(".recover-password-btn").attr("disabled", false);

                if (data.status == 409) {
                    $("#recover-password-form-modal .message").html(data.message);
                } else {
                    swal({
                            title: trans('error_occurred'),
                            text: "Unable to recovery your password. Please contact support to change your password",
                            type: "error",
                            showCancelButton: true,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: trans('contact_support'),
                            cancelButtonText: "Cancel",
                            closeOnConfirm: true
                        },
                        function (isConfirm) {
                            if (isConfirm) {
                                window.location.href = "mailto:info@meritocracy.is?subject=[Error] Unable to recover password" + "&body=I can't recover my password of my profile due to a server error.";

                            }
                        });
                }
            }
        });
    } else {

        alert(trans("password_email_recovery"), trans("fill_fields_application_title"), "error");

    }


});


$("#change-password-form").submit(function (e) {
    e.preventDefault();

    var params = $("#change-password-form").find("select,textarea,input").serialize();

    $.ajax({
        type: "POST",
        url: "/password/modify",
        dataType: "json",
        data: params,
        success: function (data, textStatus, xhr) {
            if (xhr.status == 201 || xhr.status == 204) {
                alert("The password has been changed", "Password changed", "info");
            }
        },
        error: function (data, textStatus, xhr) {
            if (data != null && data.responseJSON != null) {
                swal({
                        title: trans('error_occurred'),
                        text: data.responseJSON.message,
                        type: "error",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: trans('contact_support'),
                        cancelButtonText: "Cancel",
                        closeOnConfirm: true
                    },
                    function (isConfirm) {
                        if (isConfirm) {
                            window.location.href = "mailto:info@meritocracy.is?subject=[Error] Unable to change password" + "&body=I can't change my password of my profile due to a server error.";

                        }
                    });
            } else {
                swal({
                        title: trans('error_occurred'),
                        text: "Unable to change your password. Please contact support to change your password",
                        type: "error",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: trans('contact_support'),
                        cancelButtonText: "Cancel",
                        closeOnConfirm: true
                    },
                    function (isConfirm) {
                        if (isConfirm) {
                            window.location.href = "mailto:info@meritocracy.is?subject=[Error] Unable to change password" + "&body=I can't change my password of my profile due to a server error.";

                        }
                    });
            }

        }
    });
});


$("#delete-account-form").submit(function (e) {
    e.preventDefault();

    swal({
            title: trans('disable_title'),
            text: trans('disable_desc'),
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: trans('disable_btn'),
            closeOnConfirm: false,
            showLoaderOnConfirm: true
        },
        function () {

            $.ajax({
                type: "DELETE",
                url: "/user/" + $("#userId").val() + "/delete",
                success: function (data, textStatus, xhr) {
                    if (xhr.status == 201 || xhr.status == 204) {
                        swal({
                            title: trans("account_disabled_title"),
                            text: trans("account_disabled_desc"),
                            type: "success",
                            confirmButtonColor: "#F04D52",
                            confirmButtonText: "OK"
                        }, function () {
                            location.href = '/logout';

                        });

                    }
                },
                error: function (data, textStatus, xhr) {
                    if (data.status == 409) {
                        swal({
                            title: "Unable to disable",
                            text: data.responseJSON.message,
                            type: "danger",
                            confirmButtonColor: "#F04D52",
                            confirmButtonText: "OK"
                        }, function () {
                        });
                    }
                },
                dataType: "json"
            });


        });

});
$(document).on("click", ".trumbowyg-editor", function (e) {
    $(this).css("cssText", "min-height:300px !important;");
});


$(document).ready(function () {


    $(".social-login").on("click", function () {
        var btn = $(this);
        var registrationMode = btn.attr("data-registration");
        btn.button("loading");
        var win = window.open(btn.attr("data-href"),
            "Social Login");
        var timer = setInterval(function () {
            if (win.closed) {
                clearInterval(timer);
                $.ajax({ // make an AJAX request
                    type: "GET",
                    url: "/isLogged",
                    dataType: 'json',
                    success: function (data, textStatus, xhr) {
                        if (xhr.status == 200 && data.message == 1) {
                            if (registrationMode !== "reg") {
                                location.href = '/user';
                            } else {
                                location.href = 'register/completed';
                            }

                        } else {
                            btn.button("reset");

                            alert("Unable to Log In. Please contact info@meritocracy.is");
                            $("#registration-form-modal")[0].reset();

                        }
                    },
                    error: function (data, textStatus, xhr) {
                        btn.button("reset");
                        $("#registration-form-modal")[0].reset();

                        alert("Unable to Log In. Please contact info@meritocracy.is");
                    }

                });
            }
        }, 100);
    });

    if (navigator != null && navigator.credentials != null && !isLogged() && sessionStorage.getItem("logged-out") == null) {
        try {
            navigator.credentials.get({
                password: true,
                unmediated: true
            }).then(function (cred) {
                if (cred) {

                    if (cred.type == 'password') {
                        ga('send', 'event', 'category', 'action', 'Automatic Credential Manager Log In');

                        var form = new FormData();

                        var csrf_token = $("input[name=csrf_token]").val();
                        form.append('csrf_token', csrf_token);
                        cred.additionalData = form;

                        fetch("/login", {
                            method: 'POST',
                            credentials: cred
                        }).then(function (r) {
                            if (r.status == 200) {
                                window.location.search += '&loggedAuto=1';
                            }
                        });
                    }
                }

            });

        } catch (e) {
            console.log(e);
        }
    }


    $(".load-file").click(function (e) {

        var button = $(this);
        filepicker.setKey("A8gsh1avRW6BM45L8W9tqz");


        filepicker.pick(
            {
                maxFiles: 1,
                container: 'modal',
                extensions: ['.png', '.tiff', '.jpg', '.jpeg', '.gif', '.pdf', '.doc', '.docx'],
                services: ['COMPUTER', 'GMAIL', 'DROPBOX', 'GOOGLE_DRIVE', 'SKYDRIVE', 'BOX', 'CLOUDDRIVE'],
                language: $("html").attr("lang")
            },
            function (Blobs) {
                var url = Blobs.url;

                var res = url.split("/");
                $.ajax({
                    type: "POST",
                    url: "/attachment",
                    data: {type: "CV", "link": url, "name": res[res.length - 1], "user": {"id": $("#userId").val()}},
                    success: function (data, textStatus, xhr) {
                        if (xhr.status == 201 || xhr.status == 204) {

                            if (button.attr("rel") == "application-phase") {
                                console.log(data);
                                $("#attachment_id").val(data.id);
                                button.attr("disabled", true);
                                button.addClass("disabled");
                                button.text(trans('cv_uploaded'));
                                return true;
                            }

                            Materialize.toast("The attachment has been uploaded correctly", 3000);
                            location.href = '';

                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        Materialize.toast("Unable to save your cv", 4000);
                        Raven.setExtraContext({
                            "Ajax xhr": jqXHR,
                            "Ajax ajaxOptions": ajaxOptions,
                            "Ajax thrownError": thrownError
                        });
                        Raven.showReportDialog();
                    },
                    dataType: "json"
                });


            },
            function (FPError) {
            }
        );
    });


});